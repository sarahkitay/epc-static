"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const P=require("react"),S=require("../../contexts/form/form.cjs.js"),A=require("../../hooks/use-event-listener.cjs.js"),h=require("./ach.styles.cjs.js"),C=require("./ach.utils.cjs.js");function q(t){if(t&&t.__esModule)return t;const i=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const r in t)if(r!=="default"){const c=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(i,r,c.get?c:{enumerable:!0,get:()=>t[r]})}}return i.default=t,Object.freeze(i)}const e=q(P);function g({accountHolderName:t,transactionId:i,callbacks:r,buttonProps:c,children:p,svgProps:R,redirectURI:x}){const[l,_]=e.useState(()=>{}),[j,y]=e.useState(!1),{cardTokenizeResponseReceived:w,createPaymentRequest:u,payments:b}=S.useForm(),m=e.useRef(null),k=async s=>{if(s.stopPropagation(),!l){console.warn("ACH button was clicked, but no ACH instance was found.");return}if(!u)throw new Error("`createPaymentRequest()` is required when using ACH payments");y(!0);try{const n=await l.tokenize({accountHolderName:t,intent:"CHARGE",amount:u.total.amount,currency:u.currencyCode});if(n?.status==="OK")return await w(n);let o=`Tokenization failed with status: ${n?.status??""}`;if(n&&"errors"in n)throw o+=` and errors: ${JSON.stringify(n?.errors)}`,new Error(o);console.warn(o)}catch(n){console.error(n)}finally{y(!1)}};if(e.useEffect(()=>{const s=new AbortController,{signal:n}=s,o=async f=>{const{tokenResult:a}=f.detail;a?.status=="OK"&&await w(a)};return(async f=>{const a=await b?.ach({transactionId:i}).then(v=>{if(!f?.aborted)return _(v),v});f.aborted?(a?.removeEventListener("ontokenization",o),await a?.destroy()):a?.addEventListener("ontokenization",o)})(n),()=>{s.abort()}},[u,b]),r)for(const s of Object.keys(r))l?.addEventListener(C.transformPlaidEventName(s),r[s]);A.useEventListener({listener:k,type:"click",element:m,options:{passive:!0}});const{isLoading:z,...E}=c??{},d=z||!l||j;return p?e.createElement(h.PayButton,{...E,"aria-disabled":d,disabled:d,ref:m,type:"button"},p):e.createElement(h.PayButton,{...E,"aria-disabled":d,disabled:d,ref:m,type:"button"},e.createElement(h.SvgIcon,{fill:"none",height:"1em",viewBox:"0 0 36 24",width:"1em",xmlns:"http://www.w3.org/2000/svg",...R},e.createElement("rect",{fill:"url(#prefix__paint0_linear)",height:24,rx:4,width:36}),e.createElement("path",{clipRule:"evenodd",d:"M18.509 6.16a.89.89 0 00-1.018 0l-6.124 4.285a.848.848 0 00-.325.96.873.873 0 00.833.595h1.75v4.286h-1.75a.866.866 0 00-.875.857c0 .473.392.857.875.857h12.25a.866.866 0 00.875-.857.866.866 0 00-.875-.857h-1.75V12h1.75c.38 0 .717-.24.833-.596a.848.848 0 00-.324-.959L18.509 6.16zm2.116 10.126V12h-5.25v4.286h5.25zM18 7.91l3.395 2.376h-6.79L18 7.91z",fill:"#fff",fillRule:"evenodd"}),e.createElement("defs",null,e.createElement("linearGradient",{gradientUnits:"userSpaceOnUse",id:"prefix__paint0_linear",x1:36,x2:0,y1:12,y2:12},e.createElement("stop",{stopColor:"#01D09E"}),e.createElement("stop",{offset:1,stopColor:"#03E4AE"})))),e.createElement("span",null,"Pay with Direct debit (ACH)"))}exports.Ach=g;exports.default=g;
//# sourceMappingURL=ach.cjs.js.map
